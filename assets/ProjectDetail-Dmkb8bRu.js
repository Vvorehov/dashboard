import{_ as W,d as X,e as $,p as J,q as at,c as D,a as O,o as c,w as a,b as d,f as m,g as F,t as j,h as t,r,j as x,s as U,k as L,F as N,v as st,x as lt,y as nt,z as q,l as ot,m as it,E as Q,u as rt}from"./index-XQDU_QM-.js";const ct={name:"TaskItem",components:{Edit:$,Delete:X},props:{task:{type:Object,required:!0},projectId:{type:String,required:!0}},emits:["status-change","delete"],setup(i,{emit:s}){const u=[{label:"Pending",value:"pending"},{label:"In Progress",value:"in-progress"},{label:"Completed",value:"completed"}],e=J(i.task.status);at(()=>{e.value=i.task.status});const v=g=>{s("status-change",i.task.id,g)},A=D(()=>{switch(i.task.priority){case"high":return"danger";case"medium":return"warning";case"low":return"success";default:return"info"}}),T=D(()=>i.task.description?i.task.description.length>60?i.task.description.substring(0,60)+"...":i.task.description:""),h=D(()=>i.task.dueDate?(console.log("due date",i.task.dueDate),new Date(i.task.dueDate).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"})):""),f=D(()=>{if(!i.task.dueDate||i.task.status==="completed")return!1;const g=new Date;return g.setHours(0,0,0,0),new Date(i.task.dueDate)<g});return{statusOptions:u,currentStatus:e,handleStatusChange:v,priorityTagType:A,formattedDueDate:h,isOverdue:f,truncatedDescription:T}}},dt={class:"task-header"},ut={class:"task-title"},_t={class:"task-actions"},pt={key:0,class:"task-description"},mt={class:"task-details"},ft={class:"detail-item"},yt={key:0,class:"detail-item"},gt={class:"task-status"};function ht(i,s,u,e,v,A){const T=r("Delete"),h=r("el-icon"),f=r("el-button"),g=r("Edit"),p=r("router-link"),_=r("el-tag"),B=r("el-option"),R=r("el-select"),w=r("el-card");return c(),O(w,{class:U(["task-item",`priority-${u.task.priority}`])},{default:a(()=>[d("div",dt,[d("h3",ut,j(u.task.title),1),d("div",_t,[t(f,{size:"small",type:"danger",circle:"",onClick:s[0]||(s[0]=o=>i.$emit("delete",u.task))},{default:a(()=>[t(h,null,{default:a(()=>[t(T)]),_:1})]),_:1}),t(p,{to:`/projects/${u.projectId}/tasks/${u.task.id}/edit`},{default:a(()=>[t(f,{size:"small",type:"primary",circle:""},{default:a(()=>[t(h,null,{default:a(()=>[t(g)]),_:1})]),_:1})]),_:1},8,["to"])])]),e.truncatedDescription?(c(),m("p",pt,j(e.truncatedDescription),1)):F("",!0),d("div",mt,[d("div",ft,[t(_,{type:e.priorityTagType,effect:"light",size:"small"},{default:a(()=>[x(j(u.task.priority.charAt(0).toUpperCase()+u.task.priority.slice(1))+" Priority ",1)]),_:1},8,["type"])]),u.task.dueDate?(c(),m("div",yt,[s[2]||(s[2]=d("span",{class:"detail-label"},"Due:",-1)),d("span",{class:U({overdue:e.isOverdue})},j(e.formattedDueDate),3)])):F("",!0)]),d("div",gt,[t(R,{modelValue:e.currentStatus,"onUpdate:modelValue":s[1]||(s[1]=o=>e.currentStatus=o),placeholder:"Status",size:"small",onChange:e.handleStatusChange},{default:a(()=>[(c(!0),m(N,null,L(e.statusOptions,o=>(c(),O(B,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])]),_:1},8,["class"])}const kt=W(ct,[["render",ht],["__scopeId","data-v-04991af4"]]),vt={name:"KanbanColumn",components:{TaskItem:kt},props:{title:{type:String,required:!0},type:{type:String,required:!0,validator:i=>["pending","in-progress","completed","all"].includes(i)},tasks:{type:Array,default:()=>[]},projectId:{type:String,required:!0},emptyText:{type:String,default:""}},emits:["status-change","delete"],setup(i,{emit:s}){return{handleStatusChange:(e,v)=>{console.log("KanbanColumn - forwarding status change:",e,v),console.log("Column type:",i.type,"Project ID:",i.projectId),s("status-change",e,v)}}}},Dt={class:"kanban-column"},bt={class:"task-count"},jt={class:"column-content"},Tt={key:0,class:"empty-column"};function Ct(i,s,u,e,v,A){const T=r("task-item");return c(),m("div",Dt,[d("div",{class:U(["column-header",u.type])},[d("h3",null,j(u.title),1),d("span",bt,j(u.tasks.length),1)],2),d("div",jt,[u.tasks.length===0?(c(),m("div",Tt,[d("p",null,"No "+j(u.emptyText)+" tasks",1)])):F("",!0),(c(!0),m(N,null,L(u.tasks,h=>(c(),O(T,{key:h.id,task:h,"project-id":u.projectId,onStatusChange:e.handleStatusChange,onDelete:s[0]||(s[0]=f=>i.$emit("delete",f)),class:"task-card"},null,8,["task","project-id","onStatusChange"]))),128))])])}const St=W(vt,[["render",Ct],["__scopeId","data-v-ae2e9a8b"]]),xt={name:"ProjectDetail",components:{KanbanColumn:St,Edit:$,Delete:X,Plus:lt,Close:st},props:{id:{type:String,required:!0}},setup(i){const s=ot(),u=rt(),e={PRIORITY_FILTER:`project_${i.id}_priority_filter`,SORT_BY:`project_${i.id}_sort_by`},v={PENDING:"pending",IN_PROGRESS:"in-progress",COMPLETED:"completed"},A=[{label:"All",value:"all"},{label:"Pending",value:v.PENDING},{label:"In Progress",value:v.IN_PROGRESS},{label:"Completed",value:v.COMPLETED}],T=[{label:"All",value:"all"},{label:"Low",value:"low"},{label:"Medium",value:"medium"},{label:"High",value:"high"}],h=[{label:"Due Date (Ascending)",value:"dueDate-asc"},{label:"Due Date (Descending)",value:"dueDate-desc"},{label:"Priority (Highest first)",value:"priority-desc"},{label:"Priority (Lowest first)",value:"priority-asc"},{label:"Title (A-Z)",value:"title-asc"},{label:"Title (Z-A)",value:"title-desc"}],f=(l,y)=>{try{const k=localStorage.getItem(l);return k?JSON.parse(k):y}catch(k){return console.error("Error loading from localStorage:",k),y}},g=(l,y)=>{try{localStorage.setItem(l,JSON.stringify(y))}catch(k){console.error("Error saving to localStorage:",k)}},p=nt({priority:f(e.PRIORITY_FILTER,"all"),status:f(`project_${i.id}_status_filter`,"all")}),_=J(f(e.SORT_BY,"dueDate-asc")),B=J("kanban");q(()=>p.priority,l=>{g(e.PRIORITY_FILTER,l)}),q(()=>p.status,l=>{g(`project_${i.id}_status_filter`,l)}),q(_,l=>{g(e.SORT_BY,l)});const R=D(()=>s.getters["projects/isLoading"]),w=D(()=>s.getters["projects/allProjects"]),o=D(()=>w.value.find(l=>l.id===i.id)||null),V=D(()=>o.value&&o.value.tasks?o.value.tasks:[]),C=D(()=>{let l=V.value.filter(y=>{if(!(!p.priority||p.priority==="all")){if(y.priority!==p.priority)return!1}if(!(!p.status||p.status==="all")){if(y.status!==p.status)return!1}return!0});if(_.value){const[y,k]=_.value.split("-");l=[...l].sort((P,S)=>{if(y==="dueDate"){const b=P.dueDate?new Date(P.dueDate):new Date(0),I=S.dueDate?new Date(S.dueDate):new Date(0);return k==="asc"?b-I:I-b}if(y==="priority"){const b={low:1,medium:2,high:3},I=b[P.priority]||0,Z=b[S.priority]||0;return k==="asc"?I-Z:Z-I}if(y==="title"){const b=P.title.toLowerCase(),I=S.title.toLowerCase();return k==="asc"?b.localeCompare(I):I.localeCompare(b)}return 0})}return l}),G=D(()=>C.value.filter(l=>l.status===v.PENDING)),M=D(()=>C.value.filter(l=>l.status===v.IN_PROGRESS)),E=D(()=>C.value.filter(l=>l.status===v.COMPLETED));it(()=>{H()});function H(){s.dispatch("projects/fetchProjects")}q(o,l=>{!l&&!R.value&&w.value.length>0&&u.push({name:"Home"})});const K=(l,y)=>{if(!o.value)return;const k=o.value.tasks.find(P=>P.id===l);if(k){console.log("Updating task status from",k.status,"to",y);const P={...k,status:y},S=o.value.tasks.findIndex(b=>b.id===l);S!==-1&&o.value.tasks.splice(S,1,P),s.dispatch("tasks/updateTaskStatus",{projectId:o.value.id,taskId:l,newStatus:y}).catch(b=>{console.error("Failed to update task status:",b),S!==-1&&o.value.tasks.splice(S,1,k)})}},z=l=>{Q.confirm(`Are you sure you want to delete task "${l.title}"?`,"Warning",{confirmButtonText:"Yes, Delete",cancelButtonText:"Cancel",type:"warning"}).then(()=>{s.dispatch("tasks/deleteTask",{projectId:o.value.id,taskId:l.id})}).catch(()=>{})},n=()=>{o.value&&Q.confirm(`Are you sure you want to delete project "${o.value.name}"? All associated tasks will also be deleted.`,"Warning",{confirmButtonText:"Yes, Delete",cancelButtonText:"Cancel",type:"warning"}).then(()=>{s.dispatch("projects/deleteProject",o.value.id).then(()=>{u.push({name:"Home"})})}).catch(()=>{})},Y=()=>{p.priority="all"},tt=()=>{p.status="all"},et=D(()=>p.priority!=="all"||_.value!=="dueDate-asc");return{project:o,tasks:V,filteredTasks:C,pendingTasks:G,inProgressTasks:M,completedTasks:E,isLoading:R,statusOptions:A,priorityOptions:T,sortOptions:h,filters:p,sortBy:_,viewMode:B,isFilterActive:et,updateTaskStatus:K,confirmDeleteTask:z,confirmDeleteProject:n,handlePriorityClear:Y,handleStatusClear:tt,clearAllFilters:()=>{p.priority="all",p.status="all",_.value="dueDate-asc"},isTaskOverdue:l=>{if(!l.dueDate||l.status==="completed")return!1;const y=new Date;return y.setHours(0,0,0,0),new Date(l.dueDate)<y},formatDueDate:l=>new Date(l).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"})}}},wt={class:"proj-detail"},Pt={key:0,class:"proj-header"},It={class:"title-wrapper"},Et={class:"proj-title"},Ot={class:"actions"},At={class:"proj-description"},Bt={key:1,class:"proj-header"},Rt={class:"title-wrapper"},Lt={class:"actions",style:{display:"flex",gap:"10px"}},Nt={key:3,class:"task-section"},Ft={class:"header-content"},zt={key:0,class:"filter-indicator"},Vt={key:1,class:"list-view"},Gt={key:1},Mt={key:2,class:"kanban-board"},Yt={key:4,class:"task-section"},qt={class:"kanban-board"},Ut={class:"column-header-skeleton"},Ht={class:"column-content-skeleton"},Kt={style:{display:"flex","justify-content":"space-between"}};function Jt(i,s,u,e,v,A){const T=r("Edit"),h=r("el-icon"),f=r("el-button"),g=r("router-link"),p=r("Delete"),_=r("el-skeleton-item"),B=r("el-empty"),R=r("Close"),w=r("el-tag"),o=r("el-col"),V=r("Plus"),C=r("el-row"),G=r("el-option"),M=r("el-select"),E=r("el-table-column"),H=r("el-button-group"),K=r("el-table"),z=r("kanban-column");return c(),m("div",wt,[e.project?(c(),m("div",Pt,[d("div",It,[d("h1",Et,j(e.project.name),1),d("div",Ot,[t(g,{to:`/projects/${e.project.id}/edit`},{default:a(()=>[t(f,{type:"primary",size:"small"},{default:a(()=>[t(h,null,{default:a(()=>[t(T)]),_:1}),s[2]||(s[2]=x(" Edit Project "))]),_:1})]),_:1},8,["to"]),t(f,{type:"danger",size:"small",onClick:e.confirmDeleteProject},{default:a(()=>[t(h,null,{default:a(()=>[t(p)]),_:1}),s[3]||(s[3]=x(" Delete Project "))]),_:1},8,["onClick"])])]),d("p",At,j(e.project.description),1)])):e.isLoading?(c(),m("div",Bt,[d("div",Rt,[t(_,{variant:"h1",style:{width:"50%",height:"32px"}}),d("div",Lt,[t(_,{variant:"button",style:{width:"100px",height:"32px"}}),t(_,{variant:"button",style:{width:"120px",height:"32px"}})])]),t(_,{variant:"p",style:{width:"100%",height:"60px","margin-top":"15px"}})])):e.isLoading?F("",!0):(c(),O(B,{key:2,description:"Project not found"},{default:a(()=>[t(g,{to:"/"},{default:a(()=>[t(f,{type:"primary"},{default:a(()=>s[4]||(s[4]=[x("Back to Projects")])),_:1})]),_:1})]),_:1})),e.project?(c(),m("div",Nt,[t(C,{class:"task-header",gutter:10},{default:a(()=>[t(o,{xs:18,sm:20},{default:a(()=>[d("div",Ft,[s[6]||(s[6]=d("h2",{class:"section-title"},"Tasks",-1)),e.isFilterActive?(c(),m("div",zt,[t(w,{size:"small",type:"info"},{default:a(()=>[s[5]||(s[5]=x(" Filtered ")),t(f,{type:"text",size:"small",class:"clear-btn",onClick:e.clearAllFilters},{default:a(()=>[t(h,null,{default:a(()=>[t(R)]),_:1})]),_:1},8,["onClick"])]),_:1})])):F("",!0)])]),_:1}),t(o,{xs:6,sm:4,style:{"text-align":"right"}},{default:a(()=>[t(g,{to:`/projects/${e.project.id}/tasks/new`},{default:a(()=>[t(f,{type:"success",size:"small"},{default:a(()=>[t(h,null,{default:a(()=>[t(V)]),_:1}),s[7]||(s[7]=x(" Add "))]),_:1})]),_:1},8,["to"])]),_:1})]),_:1}),t(C,{class:"filters",gutter:10},{default:a(()=>[t(o,{span:12},{default:a(()=>[t(M,{modelValue:e.filters.priority,"onUpdate:modelValue":s[0]||(s[0]=n=>e.filters.priority=n),placeholder:"Filter by Priority",clearable:"",class:"filter-select",style:{width:"100%"},onClear:e.handlePriorityClear},{default:a(()=>[(c(!0),m(N,null,L(e.priorityOptions,n=>(c(),O(G,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onClear"])]),_:1}),t(o,{span:12},{default:a(()=>[t(M,{modelValue:e.sortBy,"onUpdate:modelValue":s[1]||(s[1]=n=>e.sortBy=n),placeholder:"Sort By",class:"filter-select",style:{width:"100%"}},{default:a(()=>[(c(!0),m(N,null,L(e.sortOptions,n=>(c(),O(G,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),!e.isLoading&&e.tasks.length===0?(c(),O(B,{key:0,description:"No tasks found"},{default:a(()=>[t(g,{to:`/projects/${e.project.id}/tasks/new`},{default:a(()=>[t(f,{type:"primary"},{default:a(()=>s[8]||(s[8]=[x("Create New Task")])),_:1})]),_:1},8,["to"])]),_:1})):e.viewMode==="list"?(c(),m("div",Vt,[t(K,{data:e.filteredTasks,style:{width:"100%"}},{default:a(()=>[t(E,{prop:"title",label:"Title"}),t(E,{label:"Status"},{default:a(({row:n})=>[t(w,{type:n.status==="completed"?"success":n.status==="in-progress"?"warning":"info"},{default:a(()=>[x(j(n.status==="pending"?"Pending":n.status==="in-progress"?"In Progress":"Completed"),1)]),_:2},1032,["type"])]),_:1}),t(E,{label:"Priority"},{default:a(({row:n})=>[t(w,{type:n.priority==="high"?"danger":n.priority==="medium"?"warning":"success",effect:"light"},{default:a(()=>[x(j(n.priority.charAt(0).toUpperCase()+n.priority.slice(1)),1)]),_:2},1032,["type"])]),_:1}),t(E,{label:"Due Date"},{default:a(({row:n})=>[n.dueDate?(c(),m("span",{key:0,class:U({overdue:e.isTaskOverdue(n)})},j(e.formatDueDate(n.dueDate)),3)):(c(),m("span",Gt,"-"))]),_:1}),t(E,{label:"Actions",width:"150"},{default:a(({row:n})=>[t(H,null,{default:a(()=>[t(g,{to:`/projects/${e.project.id}/tasks/${n.id}/edit`},{default:a(()=>[t(f,{size:"small",type:"primary"},{default:a(()=>[t(h,null,{default:a(()=>[t(T)]),_:1})]),_:1})]),_:2},1032,["to"]),t(f,{size:"small",type:"danger",onClick:Y=>e.confirmDeleteTask(n)},{default:a(()=>[t(h,null,{default:a(()=>[t(p)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])])):(c(),m("div",Mt,[t(z,{title:"Pending",type:"pending",tasks:e.pendingTasks,"project-id":e.project.id,"empty-text":"pending",onStatusChange:e.updateTaskStatus,onDelete:e.confirmDeleteTask},null,8,["tasks","project-id","onStatusChange","onDelete"]),t(z,{title:"In Progress",type:"in-progress",tasks:e.inProgressTasks,"project-id":e.project.id,"empty-text":"in progress",onStatusChange:e.updateTaskStatus,onDelete:e.confirmDeleteTask},null,8,["tasks","project-id","onStatusChange","onDelete"]),t(z,{title:"Completed",type:"completed",tasks:e.completedTasks,"project-id":e.project.id,"empty-text":"completed",onStatusChange:e.updateTaskStatus,onDelete:e.confirmDeleteTask},null,8,["tasks","project-id","onStatusChange","onDelete"])]))])):e.isLoading?(c(),m("div",Yt,[t(C,{class:"task-header",gutter:10},{default:a(()=>[t(o,{xs:18,sm:20},{default:a(()=>[t(_,{variant:"h3",style:{width:"30%",height:"24px"}})]),_:1}),t(o,{xs:6,sm:4,style:{"text-align":"right"}},{default:a(()=>[t(_,{variant:"button",style:{width:"80px",height:"32px"}})]),_:1})]),_:1}),t(C,{class:"filters",gutter:10},{default:a(()=>[t(o,{span:12},{default:a(()=>[t(_,{variant:"text",style:{width:"100%",height:"40px"}})]),_:1}),t(o,{span:12},{default:a(()=>[t(_,{variant:"text",style:{width:"100%",height:"40px"}})]),_:1})]),_:1}),d("div",qt,[(c(),m(N,null,L(3,n=>d("div",{key:n,class:"kanban-column-skeleton"},[d("div",Ut,[t(_,{variant:"text",style:{width:"60%",height:"24px"}})]),d("div",Ht,[(c(),m(N,null,L(2,Y=>d("div",{key:Y,class:"task-skeleton"},[t(_,{variant:"text",style:{width:"90%",height:"22px","margin-bottom":"10px"}}),t(_,{variant:"p",style:{width:"100%",height:"40px","margin-bottom":"10px"}}),d("div",Kt,[t(_,{variant:"text",style:{width:"40%",height:"20px"}}),t(_,{variant:"text",style:{width:"40%",height:"20px"}})])])),64))])])),64))])])):F("",!0)])}const $t=W(xt,[["render",Jt],["__scopeId","data-v-e1b35ec7"]]);export{$t as default};
