import{_ as S,f as v,o as d,h as l,a as D,g as x,w as r,r as s,b as E,t as V,j as c,i as B,F,k as P,p as C,c as j,l as M,m as L,E as U,u as N,n as I}from"./index-BMGTSiyw.js";import{u as O}from"./useForm-BIpF2h4R.js";const q={name:"TaskForm",props:{projectId:{type:String,required:!0},taskId:{type:String,default:null}},setup(i){const a=M(),m=N(),t=C(null),p=j(()=>!!i.taskId),T=[{label:"Pending",value:"pending"},{label:"In Progress",value:"in-progress"},{label:"Completed",value:"completed"}],f=[{label:"Low",value:"low"},{label:"Medium",value:"medium"},{label:"High",value:"high"}],g={title:"",description:"",priority:"medium",status:"pending",dueDate:null},_={title:[{required:!0,message:"Please enter a task title",trigger:"blur"},{min:2,max:100,message:"Length should be 2 to 100 characters",trigger:"blur"}],description:[{max:500,message:"Description cannot exceed 500 characters",trigger:"blur"}],priority:[{required:!0,message:"Please select a priority",trigger:"change"}],status:[{required:!0,message:"Please select a status",trigger:"change"}]},{formData:o,isSubmitting:n,errors:k}=O(g),y=j(()=>a.getters["projects/isLoading"]),h=j(()=>a.getters["projects/allProjects"]),u=j(()=>h.value.find(e=>e.id===i.projectId)||null);L(async()=>{if(await a.dispatch("projects/fetchProjects"),!!u.value&&p.value){const e=a.getters["tasks/getTaskById"](i.projectId,i.taskId);console.log("task",e),e?(o.title=e.title||"",o.description=e.description||"",o.priority=e.priority||"medium",o.status=e.status||"pending",o.dueDate=e.dueDate||null):U.alert("Task not found.","Error",{confirmButtonText:"OK",callback:()=>{m.push({name:"ProjectDetail",params:{id:i.projectId}})}})}});const w=async()=>{if(t.value)try{if(!await t.value.validate())return;p.value?(await a.dispatch("tasks/updateTask",{projectId:i.projectId,task:{id:i.taskId,title:o.title,description:o.description,priority:o.priority,status:o.status,dueDate:o.dueDate}}),I({message:"Task updated successfully",type:"success"})):(await a.dispatch("tasks/addTask",{projectId:i.projectId,task:{title:o.title,description:o.description,priority:o.priority,status:o.status,dueDate:o.dueDate}}),I({message:"Task created successfully",type:"success"})),b()}catch(e){console.error("Failed to save task:",e),I({message:"Failed to save task",type:"error"})}},b=()=>{m.push({name:"ProjectDetail",params:{id:i.projectId}})};return{formData:o,isSubmitting:n,errors:k,taskForm:t,isEditing:p,isLoading:y,project:u,statusOpts:T,priorityOpts:f,rules:_,submitForm:w,goBack:b}}},Y={class:"task-form"},H={class:"page-title"},K={key:0,class:"proj-info"};function R(i,a,m,t,p,T){const f=s("router-link"),g=s("el-col"),_=s("el-row"),o=s("el-input"),n=s("el-form-item"),k=s("el-option"),y=s("el-select"),h=s("el-date-picker"),u=s("el-button"),w=s("el-form"),b=s("el-empty");return d(),v("div",Y,[l(_,null,{default:r(()=>[l(g,{span:24},{default:r(()=>[E("h1",H,V(t.isEditing?"Edit Task":"Create New Task"),1),t.project?(d(),v("p",K,[a[5]||(a[5]=c(" For project: ")),l(f,{to:`/projects/${m.projectId}`},{default:r(()=>[c(V(t.project.name),1)]),_:1},8,["to"])])):x("",!0)]),_:1})]),_:1}),t.project?(d(),D(_,{key:0},{default:r(()=>[l(g,{xs:24,sm:20,md:16,lg:12},{default:r(()=>[l(w,{model:t.formData,rules:t.rules,ref:"taskForm","label-position":"top",onSubmit:B(t.submitForm,["prevent"])},{default:r(()=>[l(n,{label:"Task Title",prop:"title"},{default:r(()=>[l(o,{modelValue:t.formData.title,"onUpdate:modelValue":a[0]||(a[0]=e=>t.formData.title=e),placeholder:"Enter task title",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(n,{label:"Description",prop:"description"},{default:r(()=>[l(o,{modelValue:t.formData.description,"onUpdate:modelValue":a[1]||(a[1]=e=>t.formData.description=e),type:"textarea",rows:4,placeholder:"Enter task description",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(n,{label:"Priority",prop:"priority"},{default:r(()=>[l(y,{modelValue:t.formData.priority,"onUpdate:modelValue":a[2]||(a[2]=e=>t.formData.priority=e),placeholder:"Select priority",style:{width:"100%"}},{default:r(()=>[(d(!0),v(F,null,P(t.priorityOpts,e=>(d(),D(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"Status",prop:"status"},{default:r(()=>[l(y,{modelValue:t.formData.status,"onUpdate:modelValue":a[3]||(a[3]=e=>t.formData.status=e),placeholder:"Select status",style:{width:"100%"}},{default:r(()=>[(d(!0),v(F,null,P(t.statusOpts,e=>(d(),D(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"Due Date",prop:"dueDate"},{default:r(()=>[l(h,{modelValue:t.formData.dueDate,"onUpdate:modelValue":a[4]||(a[4]=e=>t.formData.dueDate=e),type:"date",placeholder:"Select due date",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(n,null,{default:r(()=>[l(u,{type:"primary","native-type":"submit",loading:t.isSubmitting},{default:r(()=>[c(V(t.isEditing?"Update Task":"Create Task"),1)]),_:1},8,["loading"]),l(u,{onClick:t.goBack,plain:""},{default:r(()=>a[6]||(a[6]=[c("Cancel")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules","onSubmit"])]),_:1})]),_:1})):t.isLoading?x("",!0):(d(),D(b,{key:1,description:"Project not found"},{default:r(()=>[l(f,{to:"/"},{default:r(()=>[l(u,{type:"primary"},{default:r(()=>a[7]||(a[7]=[c("Back to Projects")])),_:1})]),_:1})]),_:1}))])}const G=S(q,[["render",R],["__scopeId","data-v-1f5239ad"]]);export{G as default};
